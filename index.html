<!DOCTYPE html>
<html>
	<head>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-5YNPJJ5JZX"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'G-5YNPJJ5JZX');
		</script>
		<meta charset="UTF-8" />
		<link rel="icon" href="./coinPos1.jpg" />
		<title>BTF | ETF</title>
		<link rel="stylesheet" href="styles.css" />
	</head>

	<body>
		<canvas id="gameCanvas" width="screen.width" height="screen.height"></canvas>
		<img id="coinPos1" width="0" height="0" src="./coinPos1.jpg" alt="coinPos1" />
		<img id="coinPos2" width="0" height="0" src="./coinPos2.jpg" alt="coinPos2" />
		<img id="coinPos3" width="0" height="0" src="./coinPos3.jpg" alt="coinPos3" />
		<img id="coinPos4" width="0" height="0" src="./coinPos4.jpg" alt="coinPos4" />
		<img id="coinPos5" width="0" height="0" src="./coinPos5.jpg" alt="coinPos5" />
		<img id="coinPos6" width="0" height="0" src="./coinPos6.jpg" alt="coinPos6" />
		<img id="coinPos7" width="0" height="0" src="./coinPos7.jpg" alt="coinPos7" />
		<img id="coinPos8" width="0" height="0" src="./coinPos8.jpg" alt="coinPos8" />
		<img id="coinPos9" width="0" height="0" src="./coinPos9.jpg" alt="coinPos9" />
		<img id="bullpng" width="0" height="0" src="./bull.PNG" alt="bullpng" />
		<img id="bullWithLazers" width="0" height="0" src="./bullWithLazers.PNG" alt="bullWithLazers" />
		<img
			id="bear"
			width="0"
			height="0"
			src="https://www.clipartmax.com/png/middle/453-4536743_bear-clipart-mad-bear-bear-smile-emoji.png"
			alt="bear"
		/>

		<script>
			const FPS = 30; // frames per second
			const FRICTION = 0.7; // friction coefficient of space (0 = none, 1 = lots)
			const BULL_SIZE = 30; // in pixels
			const TURN_SPEED = 360; // turn speed in degrees per second
			let SCORE = 0;
			let TOTAL_SCORE = 0;
			let TIME = 0;
			let choice = 'coinPos1';

			// get canvas properties
			var canvas = document.getElementById('gameCanvas');
			var context = canvas.getContext('2d');
			context.canvas.width = window.innerWidth - 50;
			context.canvas.height = window.innerHeight - 50;
			coinPos = { x: canvas.width / 2, y: canvas.height / 2 };

			var bull = {
				x: canvas.width / 2,
				y: canvas.height / 2,
				r: BULL_SIZE / 2,
				moveUp: false,
				moveDown: false,
				moveLeft: false,
				moveRight: false,
			};

			var bears = [
				{
					x: coinPos.x - 25,
					y: coinPos.y - 25,
					r: BULL_SIZE / 2,
					moveUp: false,
					moveDown: false,
					moveLeft: true,
					moveRight: false,
				},
			];

			// event handlers
			document.addEventListener('keydown', keyDown);
			document.addEventListener('keyup', keyUp);

			// update loop
			setInterval(update, 1000 / FPS);

			function keyDown(/** @type {KeyboardEvent} */ ev) {
				switch (ev.keyCode) {
					case 32: // spacebard (bull charge)
						bull.charge = true;
						break;
					case 37: // left arrow (move bull left)
						bull.moveLeft = true;
						break;
					case 38: // up arrow (move bull down)
						bull.moveDown = true;
						break;
					case 39: // right arrow (move bull right)
						bull.moveRight = true;
						break;
					case 40: // up arrow (move bull up)
						bull.moveUp = true;
						break;
				}
			}

			function keyUp(/** @type {KeyboardEvent} */ ev) {
				switch (ev.keyCode) {
					case 32: // space (stop bull charge)
						bull.charge = false;
						break;
					case 37: // left arrow (stop bull left)
						bull.moveLeft = false;
						break;
					case 38: // up arrow (stop bull up)
						// ship.thrusting = false;
						bull.moveDown = false;
						break;
					case 39: // right arrow (stop bull right)
						// ship.rotation = 0;
						bull.moveRight = false;
						break;
					case 40: // down arrow (stop bull down)
						bull.moveUp = false;
						break;
				}
			}

			function update() {
				context.canvas.width = window.innerWidth;
				context.canvas.height = window.innerHeight;
				// draw space
				context.fillStyle = 'white';
				context.fillRect(0, 0, canvas.width, canvas.height);

				function move(object) {
					if (object.moveLeft) {
						object.x = object.x - 5;
					}
					if (object.moveRight) {
						object.x = object.x + 5;
					}
					if (object.moveUp) {
						object.y = object.y + 5;
					}
					if (object.moveDown) {
						object.y = object.y - 5;
					}
				}

				move(bull);
				if (bull.charge) {
					move(bull);
					move(bull);
					move(bull);
				}

				// handle edge of screen
				function handleEdge(object) {
					if (object.x < 0 - object.r) {
						object.x = canvas.width + object.r;
					} else if (object.x > canvas.width + object.r) {
						object.x = 0 - object.r;
					}
					if (object.y < 0 - object.r) {
						object.y = canvas.height + object.r;
					} else if (object.y > canvas.height + object.r) {
						object.y = 0 - object.r;
					}
				}

				var bearimg = document.getElementById('bear');

				for (bear in bears) {
					if (TIME % 25 == 0) {
						let i = Math.floor(Math.random() * 4);
						if (i == 1) {
							bears[bear].moveDown = true;
							bears[bear].moveLeft = false;
						} else if (i == 2) {
							bears[bear].moveRight = true;
							bears[bear].moveDown = false;
						} else if (i == 3) {
							bears[bear].moveUp = true;
							bears[bear].moveRight = false;
						} else if (i == 0) {
							bears[bear].moveLeft = true;
							bears[bear].moveUp = false;
						}
					}
					move(bears[bear]);
					handleEdge(bears[bear]);

					//if bull runs into bear
					if (Math.sqrt((bull.x - bears[bear].x) * (bull.x - bears[bear].x) + (bull.y - bears[bear].y) * (bull.y - bears[bear].y)) < 75) {
						SCORE = 0;
						bears[bear].x = Math.floor(Math.random() * context.canvas.width);
						bears[bear].y = Math.floor(Math.random() * context.canvas.height);
						bull.x = canvas.width / 2;
						bull.y = canvas.height / 2;
						bears = [
							{
								x: coinPos.x - 25,
								y: coinPos.y - 25,
								r: BULL_SIZE / 2,
								moveUp: false,
								moveDown: false,
								moveLeft: true,
								moveRight: false,
							},
						];
					}
					context.drawImage(bearimg, bears[bear].x, bears[bear].y, 100, 100);
				}

				handleEdge(bull);

				// if bull runs into coin
				if (Math.sqrt((bull.x - coinPos.x) * (bull.x - coinPos.x) + (bull.y - coinPos.y) * (bull.y - coinPos.y)) < 75) {
					SCORE++;
					TOTAL_SCORE++;
					coinPos.x = Math.floor(Math.random() * context.canvas.width);
					coinPos.y = Math.floor(Math.random() * context.canvas.height);
					bears.push({
						x: coinPos.x + 25,
						y: coinPos.y + 25,
						r: BULL_SIZE / 2,
						moveUp: false,
						moveDown: false,
						moveLeft: true,
						moveRight: false,
					});
				}

				if (TIME % 4 == 0) {
					if (choice == 'coinPos1') choice = 'coinPos2';
					else if (choice == 'coinPos2') choice = 'coinPos3';
					else if (choice == 'coinPos3') choice = 'coinPos4';
					else if (choice == 'coinPos4') choice = 'coinPos5';
					else if (choice == 'coinPos5') choice = 'coinPos6';
					else if (choice == 'coinPos6') choice = 'coinPos7';
					else if (choice == 'coinPos7') choice = 'coinPos8';
					else if (choice == 'coinPos8') choice = 'coinPos9';
					else if (choice == 'coinPos9') choice = 'coinPos1';
				}
				TIME++;
				context.fillStyle = 'black';
				context.font = '50px san-serif';

				context.fillText('Score: ' + SCORE, 20, context.canvas.height / 5);
				context.fillText('All Time: ' + TOTAL_SCORE, context.canvas.width - 250, context.canvas.height / 5);
				context.fillStyle = 'black';
				context.font = '20px san-serif';
				context.fillText('HIGH SCORE: 420\nUser: Shep Sims', context.canvas.width / 2 - 100, context.canvas.height / 20);
				var img = document.getElementById(choice);
				var bullimg = !bull.charge ? document.getElementById('bullpng') : document.getElementById('bullWithLazers');

				context.drawImage(img, coinPos.x, coinPos.y);
				context.drawImage(bullimg, bull.x, bull.y, !bull.charge ? 100 : 120, !bull.charge ? 100 : 120);
			}
		</script>
	</body>
</html>
